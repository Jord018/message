name: Lint Code Base

on: [push, pull_request]

jobs:
  eslint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: npm install

      # รัน ESLint และสั่งให้ Export เป็น HTML
      # --format html: กำหนดรูปแบบไฟล์
      # --output-file: ระบุชื่อไฟล์ปลายทาง
      # || true: เพื่อให้ Workflow ทำงานต่อแม้จะเจอ Lint Error (ถ้าต้องการให้ Fail ทันทีให้เอาออก)
      - name: Run ESLint and export HTML
        # ใช้ shell bash เพื่อให้รองรับ globbing pattern
        shell: bash
        run: |
          # 1. รัน eslint โดยระบุ pattern ไฟล์ให้ครอบคลุม
          # 2. ใช้ --output-file เพื่อบังคับเขียนไฟล์
          # 3. ใส่ || true เพื่อไม่ให้ Workflow หยุดทำงานทันทีที่เจอ Lint Error
          npx eslint "**/*.{js,jsx,ts,tsx}" --format html --output-file eslint-report.html || true

      - name: Check if file exists (Debug)
        # ขั้นตอนนี้ช่วยเช็กว่าไฟล์ถูกสร้างจริงไหม ถ้าไม่มีจะ Error ที่นี่
        run: ls -l eslint-report.html

      - name: Upload ESLint Report
        # ใช้ if: always() เพื่อให้รันเสมอแม้ Step ก่อนหน้าจะ Fail
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: eslint-report
          path: eslint-report.html
          # ถ้าหาไฟล์ไม่เจอจริงๆ ให้ Action นี้ Fail เพื่อจะได้รู้
          if-no-files-found: error 
